{{ 'main-collection.css' | asset_url | stylesheet_tag }}

{% style %}
  .collection__item {
    width: calc(100% / {{section.settings.products_per_row_desktop}});
  }

  @media screen and (max-width: 750px) {
    .collection__item {
      width: calc(100% / {{section.settings.products_per_row_mobile}});
    }
  }
{% endstyle %}

<div class="collection  {% if collection.products_count == 0 %}empty-state{% endif %}">
  <div class="collection__container">
    <div class="collection__head">
      <h2 class="collection__title">{{ collection.title }}</h2>
    </div>

    <p class="collection__page-tab selected results-count" style="text-align: center;">Products</p>
    {%- if collection.products_count > 0 -%}
      <div class="collection__content">
        <div class="collection__content-container tab active" type="products">
          <div
            class="filter__box"
            {% if section.settings.show_filter == false %}
              style="display: none;"
            {% endif %}
          >
            {% render 'snippet-filter',
              state: section.settings.filters_expanded_at_start,
              filters: collection.filters
            %}
          </div>
          <div class="collection__content--middle">
            <div class="filter__results">
              {% paginate collection.products by section.settings.products_per_page %}
                <div class="filter__results--head">
                  {% if section.settings.show_filter == true %}
                    <div class="show-filter mobile-only">
                      {% render 'snippet-icons', icon: 'search-filter' %}
                      <span>Filter</span>
                    </div>
                  {% endif %}

                  <p class="results-count-hidden" style="opacity: 0;">({{ collection.products_count }})</p>

                  <div class="sort-by">
                    <p for="SortBy">Sort by:</p>

                    <select
                      name="sort_by"
                      id="SortBy"
                      class="sort-by__select"
                    >
                      {%- for option in collection.sort_options -%}
                        <option
                          value="{{ option.value | escape }}"
                          {% if option.value == sort_by %}
                            selected="selected"
                          {% endif %}
                        >
                          {{ option.name | escape }}
                        </option>
                      {%- endfor -%}
                    </select>
                  </div>
                </div>
                <div class="filter__results--list">
                  {% for item in collection.products %}
                    <div class="collection__item reveal">
                      <div class="collection__item-container">
                        <div class="collection__item__picture corner-border">
                          {% assign price_difference_text = 'SAVE' %}
                          {% assign price_difference = item.compare_at_price | minus: product.price %}
                          {% if price_difference > 0 %}
                            <div class="collection__item__tag">
                              <!-- Add in schema, tag--animated or tag--normal dropdown -->
                              <p class="tag--animated tag-text">
                                {{ price_difference_text }}
                                {{ item.compare_at_price | minus: item.price | money }}
                              </p>
                            </div>
                          {% endif %}
                          <div
                            class="quick-add-icon"
                            id="quick-add-button"
                            data-first-available-variant-id="{{ item.first_available_variant.id }}"
                            data-product-handle="{{ item.handle }}"
                            data-product-variants="{% if item.variants.size > 1 %}with{% else %}without{% endif %}"
                          >
                            {% render 'snippet-icons', icon: 'quick-add' -%}
                          </div>
                          {% if item.featured_media != blank %}
                            <a href="{{ item.url }}" class="media corner-border-target">
                              <img
                                srcset="{{ item.featured_media | image_url }}"
                                loading="lazy"
                                alt="{{ item.featured_media.alt | escape }}"
                                width="{{ item.featured_media.width }}"
                                height="{{ item.featured_media.height }}"
                                class="full"
                              >
                            </a>
                          {% else %}
                            <a href="{{ item.url }}" class="media corner-border-target">
                              {{ 'product-1' | placeholder_svg_tag: 'placeholder' }}
                            </a>
                          {% endif %}
                        </div>

                        {% assign product_date = item.published_at | date: '%s' %}
                        {% assign current_date = 'now' | date: '%s' %}

                        {% assign difference_in_seconds = current_date | minus: product_date %}
                        {% assign difference_in_days = difference_in_seconds | divided_by: 3600 | divided_by: 24 %}

                        <a
                          href="{{ item.url }}"
                          class="collection__item__name {% if section.settings.new_tag == true and difference_in_days < section.settings.new_tag_time %}tag--animated-hover{% endif %}"
                        >
                          {{- item.title -}}
                        </a>

                        <div class="collection__item__prices">
                          <p class="price--actual">{{ item.price | money }}</p>
                          {% if item.compare_at_price != 0 %}
                            <p class="price--compare-at">{{ item.compare_at_price | money }}</p>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                  {% endfor %}
                </div>
                {% render 'snippet-pagination', paginate: paginate %}
              {% endpaginate %}
            </div>
          </div>
        </div>
      </div>
    {%- else -%}
      <p>This collection does not have any products.</p>
      <div class="buttons">
        <a
          class="button button--primary border"
          href="/collections/all"
        >
          <span></span> <span></span> <span></span> <span></span>
          SHOP NOW
        </a>
      </div>
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "collection",
  "class": "main-collection",
  "settings": [
    {
      "type": "checkbox",
      "id": "new_tag",
      "label": "Show 'NEW' tag",
      "default": true
    },
    {
      "type": "range",
      "id": "new_tag_time",
      "label": "'NEW' tag countback",
      "info": "Show the 'NEW' tag if the product is published in the last X days",
      "min": 0,
      "max": 90,
      "step": 1,
      "unit": "D",
      "default": 30
    },
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 50,
      "step": 1,
      "label": "Products per page",
      "default": 24
    },
    {
      "type": "range",
      "id": "products_per_row_desktop",
      "min": 3,
      "max": 6,
      "step": 1,
      "label": "Products per row - desktop",
      "default": 4
    },
    {
      "type": "range",
      "id": "products_per_row_mobile",
      "min": 1,
      "max": 3,
      "step": 1,
      "label": "Products per row - mobile",
      "default": 2
    },
    {
      "type": "checkbox",
      "id": "show_filter",
      "label": "Show filter",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "filters_expanded_at_start",
      "label": "Filters expanded at start",
      "default": true
    }
  ]
}
{% endschema %}

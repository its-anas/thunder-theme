{{ 'main-collection.css' | asset_url | stylesheet_tag }}

{% style %}
  {% if collection.featured_image != blank and section.settings.show_collection_image == true %}
    .collection__head {
      height: {{ section.settings.section_height }}px;
    }
  {% else %}
    .collection__head {
      margin-top: 130px;
      padding: 3rem;
    }
  {% endif %}

  .collection__item {
    width: calc(100% / {{ section.settings.products_per_row_desktop }});
  }

  @media screen and (max-width: 750px) {
    .collection__item {
      width: calc(100% / {{ section.settings.products_per_row_mobile }});
    }
  }
{% endstyle %}

<div class="collection__head">
  <div class="collection__head__title">
    <h2 class="collection__title">{{ collection.title }}</h2>
    <p>{{ collection.description }}</p>
  </div>
  {% if collection.featured_image != blank and section.settings.show_collection_image == true %}
    <div class="collection__head__image media">
      {%- assign image = collection.featured_image -%}
      {%- assign sizes = '100vw' -%}
      {%- assign widths = '350, 500, 750, 1000, 1250, 1500, 1750, 2000, 2500, 3000, 3500, 3750' -%}
      {%- assign width = '3750' -%}
      {{
        image
        | image_url: width: width
        | image_tag:
          loading: 'lazy',
          class: 'cover',
          alt: image.alt,
          width: image.width,
          height: image.height,
          sizes: sizes,
          widths: widths
      }}
    </div>
  {% endif %}
</div>

<div class="collection  {% if collection.products_count == 0 %}empty-state{% endif %}">
  <div class="collection__container">
    <p class="collection__page-tab selected results-count" style="text-align: center;">Products</p>
    {%- if collection.products_count > 0 -%}
      <div class="collection__content">
        <div class="collection__content-container tab active" type="products">
          <div
            class="filter__box"
            {% if section.settings.show_filter == false %}
              style="display: none;"
            {% endif %}
          >
            {% render 'snippet-filter',
              state: section.settings.filters_expanded_at_start,
              filters: collection.filters
            %}
          </div>
          <div class="collection__content--middle">
            <div class="filter__results">
              {% paginate collection.products by section.settings.products_per_page %}
                <div class="filter__results--head">
                  {% if section.settings.show_filter == true %}
                    <div class="show-filter mobile-only">
                      {% render 'snippet-icons', icon: 'search-filter' %}
                      <span>Filters</span>
                      <span id="filterCount"></span>
                    </div>
                  {% endif %}

                  <p class="results-count-hidden" style="opacity: 0;">({{ collection.products_count }})</p>

                  <div class="sort-by">
                    <p for="SortBy">Sort by:</p>

                    <select
                      name="sort_by"
                      id="SortBy"
                      class="sort-by__select"
                    >
                      {%- for option in collection.sort_options -%}
                        <option
                          value="{{ option.value | escape }}"
                          {% if option.value == 'sort_by' %}
                            selected="selected"
                          {% endif %}
                        >
                          {{ option.name | escape }}
                        </option>
                      {%- endfor -%}
                    </select>
                  </div>
                </div>
                <div class="filter__results--list">
                  {% for item in collection.products %}
                    <div class="collection__item reveal">
                      <div class="collection__item-container">
                        <div class="collection__item__picture corner-border">
                          {% assign price_difference_text = 'SAVE' %}
                          {% assign price_difference = item.compare_at_price | minus: product.price %}
                          {% if price_difference > 0 %}
                            <div class="collection__item__tag">
                              <p class="tag--animated tag-text">
                                {{ price_difference_text }}
                                {{ item.compare_at_price | minus: item.price | money }}
                              </p>
                            </div>
                          {% endif %}
                          <div
                            class="quick-view-button desktop-only"
                            id="quick-view-button"
                            data-first-available-variant-id="{{ item.first_available_variant.id }}"
                            data-product-handle="{{ item.handle }}"
                            data-product-variants="{% if item.variants.size > 1 %}with{% else %}without{% endif %}"
                          >
                            {% render 'snippet-icons', icon: 'quick-view' -%}
                          </div>
                          {% if item.featured_media != blank %}
                            <a href="{{ item.url }}" class="media corner-border-target">
                              {%- assign image = item.featured_media -%}
                              {%- capture sizes -%}(min-width: 1024px) calc((1175px - {{ section.settings.products_per_row_desktop | times: 2 }}rem) / {{ section.settings.products_per_row_desktop }}), (min-width: 750px) calc((100vw - 2rem - {{ section.settings.products_per_row_desktop | times: 2 }}rem) / {{ section.settings.products_per_row_desktop }}), calc((100vw - 1rem - {{ section.settings.products_per_row_mobile | times: 1 }}rem) / {{ section.settings.products_per_row_mobile }}){%- endcapture -%}
                              {%- assign widths = '125, 150, 175, 200, 225, 250, 300, 325, 350, 375' -%}
                              {%- assign width = '375' -%}
                              {{
                                image
                                | image_url: width: width
                                | image_tag:
                                  loading: 'lazy',
                                  class: 'cover',
                                  alt: image.alt,
                                  width: image.width,
                                  height: image.height,
                                  sizes: sizes,
                                  widths: widths
                              }}
                            </a>
                          {% else %}
                            <a href="{{ item.url }}" class="media corner-border-target">
                              {{ 'product-1' | placeholder_svg_tag: 'placeholder' }}
                            </a>
                          {% endif %}
                        </div>

                        {% assign product_date = item.published_at | date: '%s' %}
                        {% assign current_date = 'now' | date: '%s' %}

                        {% assign difference_in_seconds = current_date | minus: product_date %}
                        {% assign difference_in_days = difference_in_seconds | divided_by: 3600 | divided_by: 24 %}

                        <a
                          href="{{ item.url }}"
                          class="collection__item__name {% if section.settings.new_tag == true and difference_in_days < section.settings.new_tag_time %}tag--animated-hover{% endif %}"
                        >
                          {{- item.title -}}
                        </a>

                        <div class="collection__item__prices">
                          <p class="price--actual">{{ item.price | money }}</p>
                          {% if item.compare_at_price != 0 %}
                            <p class="price--compare-at">{{ item.compare_at_price | money }}</p>
                          {% endif %}
                        </div>
                        <quick-view-button>
                          <div
                            class="button--link mobile-only"
                            id="quick-view-button"
                            data-first-available-variant-id="{{ item.first_available_variant.id }}"
                            data-product-handle="{{ item.handle }}"
                            data-product-variants="{% if item.variants.size > 1 %}with{% else %}without{% endif %}"
                          >
                            {%- if item.variants.size > 1 -%}
                              Quick view +
                            {% else %}
                              Add to cart âž•
                            {%- endif -%}
                            {% render 'snippet-icons', icon: 'loading-spinner-tiny' %}
                          </div>
                        </quick-view-button>
                      </div>
                    </div>
                  {% endfor %}
                </div>
                {% render 'snippet-pagination', paginate: paginate %}
              {% endpaginate %}
            </div>
          </div>
        </div>
      </div>
    {%- else -%}
      <p>This collection does not have any products.</p>
      <div class="buttons">
        <a
          class="button button--primary border"
          href="{{ routes.collections_url }}"
        >
          <span></span> <span></span> <span></span> <span></span>
          SHOP NOW
        </a>
      </div>
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "Collection",
  "class": "main-collection",
  "settings": [
    {
      "type": "range",
      "id": "section_height",
      "min": 300,
      "max": 1000,
      "step": 100,
      "unit": "px",
      "label": "Section height",
      "default": 600
    },
    {
      "type": "range",
      "id": "products_per_page",
      "min": 8,
      "max": 50,
      "step": 1,
      "label": "Products per page",
      "default": 24
    },
    {
      "type": "range",
      "id": "products_per_row_desktop",
      "min": 3,
      "max": 6,
      "step": 1,
      "label": "Products per row - desktop/tablet",
      "default": 4
    },
    {
      "type": "select",
      "id": "products_per_row_mobile",
      "label": "Products per row - mobile",
      "options": [
        {
          "value": "1",
          "label": "1"
        },
        {
          "value": "2",
          "label": "2"
        }
      ],
      "default": "2"
    },
    {
      "type": "checkbox",
      "id": "show_collection_image",
      "label": "Show collection image",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_filter",
      "label": "Show filter",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "filters_expanded_at_start",
      "label": "Filters expanded at start",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "new_tag",
      "label": "Show 'NEW' tag",
      "default": true
    },
    {
      "type": "range",
      "id": "new_tag_time",
      "label": "'NEW' tag countback",
      "info": "Show the 'NEW' tag if the product is published in the last X days",
      "min": 0,
      "max": 90,
      "step": 1,
      "unit": "D",
      "default": 30
    }
  ]
}
{% endschema %}

{{ 'countdown-timer.css' | asset_url | stylesheet_tag }}

{%- style -%}
{%- endstyle -%}

{% liquid
  assign days = section.settings.time_days | times: 24.00 | times: 60.00
  assign hours = section.settings.time_hours | times: 60.00
  assign mins = section.settings.time_mins
  assign secs = section.settings.time_secs | divided_by: 60.00
  assign timeInMinutes = days | plus: hours | plus: mins | plus: secs
  assign year = section.settings.date_year
  assign month = section.settings.date_month | prepend: '00' | slice: -2, 2
  assign day = section.settings.date_day | prepend: '00' | slice: -2, 2
  assign hour = section.settings.date_hour | prepend: '00' | slice: -2, 2
  assign min = section.settings.date_min | prepend: '00' | slice: -2, 2
  assign sec = section.settings.date_sec | prepend: '00' | slice: -2, 2
%}

{% capture timeInDate %}{{ year }}-{{ month }}-{{ day }}T{{ hour }}:{{ min }}:{{ sec }}{% endcapture %}
{% capture coundownType %}'{{ section.settings.countdown_timer_type }}'{% endcapture %}
{% capture afterExpirationTimeOnly %}'{{ section.settings.afterExpirationTimeOnly }}'{% endcapture %}

<script>
  document.addEventListener('DOMContentLoaded', theDomHasLoaded, false);
  function theDomHasLoaded() {
    countdownTimer( {{ coundownType }}, '{{ timeInDate }}', {{ timeInMinutes }}, {{ afterExpirationTimeOnly }}, 'countdown-timer-{{ section.id }}', 'countdown-timer-cookie-{{ section.id }}');
  }
</script>
<div id="countdown-timer-{{ section.id }}" class="countdown-timer">
  <div class="countdown-timer__heading">
    <{{ section.settings.heading_size }}>
      {{ section.settings.heading }}
    </{{ section.settings.heading_size }}>
  </div>
  <div class="countdown-timer__text">
    <p>{{ section.settings.text }}</p>
  </div>
  <div class="countdown-timer__timers">
    <div class="countdown-timer__days">
      <p class="days"></p>
      <p>Days</p>
    </div>
    <div class="countdown-timer__hours">
      <p class="hours"></p>
      <p>Hours</p>
    </div>
    <div class="countdown-timer__minutes">
      <p class="minutes"><p>Minutes</p></p>
    </div>
    <div class="countdown-timer__seconds">
      <p class="seconds"><p>Seconds</p></p>
    </div>
  </div>
  <div class="countdown-timer__message">
    <h6>{{ section.settings.message }}</h6>
  </div>
  <div class="countdown-timer__buttons"><a href="">BUTTON ></a></div>
</div>

{% schema %}
{
  "name": "Countdown timer",
  "settings": [
    {
      "type": "header",
      "content": "Heading settings"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Heading"
    },
    {
      "type": "select",
      "id": "heading_size",
      "label": "Heading size",
      "options": [
        {
          "value": "h1",
          "label": "h1"
        },
        {
          "value": "h2",
          "label": "h2"
        },
        {
          "value": "h3",
          "label": "h3"
        },
        {
          "value": "h4",
          "label": "h4"
        },
        {
          "value": "h5",
          "label": "h5"
        },
        {
          "value": "h6",
          "label": "h6"
        }
      ],
      "default": "h2"
    },
    {
      "type": "text",
      "id": "text",
      "label": "Text",
      "default": "Text enset"
    },
    {
      "type": "header",
      "content": "Countdown timer settings",
      "info": "⚠️ Warning: save the settings for your new changes to take effect. If your new settings don't take effect immediately or the time disapeared, please refresh this page"
    },
    {
      "type": "text",
      "id": "message",
      "label": "After expiration message",
      "default": "Offer ended",
      "info": "It is optional for Option 1 but required for Option 2"
    },
    {
      "type": "select",
      "id": "countdown_timer_type",
      "label": "Countdown timer type",
      "options": [
        {
          "value": "time",
          "label": "Option 1: Based on user cookies"
        },
        {
          "value": "date",
          "label": "Option 2: Based on a date"
        }
      ],
      "default": "time"
    },
    {
      "type": "header",
      "content": "Option 1: Based on user cookies",
      "info": "⚠️ Remember that this option also saves your browser cookies. So if your new settings aren't taking effect immediately, simply clear the cookies and refresh the page."
    },
    {
      "type": "range",
      "id": "time_days",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "d",
      "label": "Days",
      "default": 0
    },
    {
      "type": "range",
      "id": "time_hours",
      "min": 0,
      "max": 24,
      "step": 1,
      "unit": "h",
      "label": "Hours",
      "default": 0
    },
    {
      "type": "range",
      "id": "time_mins",
      "min": 0,
      "max": 60,
      "step": 1,
      "unit": "m",
      "label": "Minutes",
      "default": 0
    },
    {
      "type": "range",
      "id": "time_secs",
      "min": 0,
      "max": 60,
      "step": 1,
      "unit": "s",
      "label": "Seconds",
      "default": 0
    },
    {
      "type": "select",
      "id": "afterExpirationTimeOnly",
      "label": "After countdown expires",
      "options": [
        {
          "value": "repeatCountdown",
          "label": "Repeat countdown"
        },
        {
          "value": "showMessage",
          "label": "Show message"
        }
      ],
      "default": "repeatCountdown",
      "info": "This applied only to Option 1."
    },
    {
      "type": "header",
      "content": "Option 2: Based on a date"
    },
    {
      "type": "range",
      "id": "date_year",
      "min": 2022,
      "max": 2032,
      "step": 1,
      "unit": "y",
      "label": "Year",
      "default": 2022
    },
    {
      "type": "range",
      "id": "date_month",
      "min": 1,
      "max": 12,
      "step": 1,
      "unit": "m",
      "label": "Month",
      "default": 1
    },
    {
      "type": "range",
      "id": "date_day",
      "min": 1,
      "max": 31,
      "step": 1,
      "unit": "d",
      "label": "Day",
      "default": 1,
      "info": "⚠️ Pay attention: If you put 31 to a month that ends with 30 or 28, it will result in an error in calculation."
    },
    {
      "type": "range",
      "id": "date_hour",
      "min": 0,
      "max": 24,
      "step": 1,
      "unit": "h",
      "label": "Hour",
      "default": 0
    },
    {
      "type": "range",
      "id": "date_min",
      "min": 0,
      "max": 60,
      "step": 1,
      "unit": "m",
      "label": "Minute",
      "default": 0
    }
  ],
  "blocks": [],
  "presets": [
    {
      "name": "Countdown timer",
      "blocks": []
    }
  ]
}
{% endschema %}
